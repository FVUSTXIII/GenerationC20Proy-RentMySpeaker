<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="CSS/style-publicacion.css">
    <script src="https://kit.fontawesome.com/edb0fd4394.js" crossorigin="anonymous"></script>
    <title>Nueva publicación</title>
</head>
<body>
    <header id ="header-area">
        <h2 id="arrendador"><a href="RentasenProceso.html">Arrendador</a></h2>
        <h2 id="publicar"><a href="publicacionform.html">Publicar</a></h2>
        <!--LOGO AREA-->
        <div id="header-logo-div">
            <i class="fas fa-compact-disc"></i>
            <h1 id="header-title">Rent My Speaker</h1>
        </div>
        <h2 id="arrendatario"><a href="estatus_rentas.html"> Arrendatario</a></h2>
        <a href="index.html"><i class="fas fa-door-open"></i></a>
    </header>    
    <main>
        
        <div id="form-box">
             <legend id="formulario_publicacion">Realiza tu publicación</legend>
            <form>

                <div>
                    <label for="titulo" class="left">Título de la publicación: </label>
                    <input type="text" name="titulo" id="titulo" class="right">
                </div>
                

                <div>
                    <label for="tipo_articulo" class="left">Tipo de artículo: </label>
                    <select name="tipo_articulo" id="tipo_articulo" class="rigth">
                        <option selected disabled>Tipo de Articulo</option>
                        <option value=0>Equipo de sonido</option>
                        <option value=1>Percusiones</option>
                        <option value=2>Instrumento de cuerda</option>
                        <option value=3>Electrónico</option>
                    </select>
                </div>
               

                <div>
                    <label for="descripcion" class="left">Descripción: </label>
                    <textarea name="descripcion" id="descripcion" class="right" cols="30" rows="10"></textarea>
                </div>

                <div>
                    <label for="img-file" class="left">Imágenes: </label>
                    <!--<input type="file" name="img" multiple="multiple" id="img-file" class="right">-->
                </div>

                <div>
                    <label for="precio-x-dia" class="left">Precio por día: </label>
                    <input type="number" name="precio-x-dia" min="1" id="precio-x-dia" class="right">
                </div>

                <input type="button" id="submbtn" value="Enviar">
            </form>
        
         </div>
    </main>
    <script>
        var usuario = localStorage.getItem("idUsuario");
        console.log(usuario);
        var boton = document.getElementById("submbtn");
        var e = document.getElementById("tipo_articulo");
        boton.onclick = () => {

            let url = "http://localhost:8080/v1/usuario/"+usuario+"/createpublicacion";
            postRequest(url).then((data) => {
                var parsed = JSON.parse(data);
                console.log(parsed);

            }).catch((data) => {
                console.error(data);
            });
        }
        function postRequest(url) {
        var xhttp = new XMLHttpRequest();
        return new Promise ((resolve, reject) => {                      
                        
            xhttp.onload = () => {
                if(xhttp.readyState === 4 && xhttp.status === 201) {
                    console.log(xhttp.responseText);
                   
                }
                 resolve(xhttp.responseText);
            }
            xhttp.open('POST' || 'GET', url, true);
            xhttp.setRequestHeader('Content-type', 'application/json; charset=utf-8');
            xhttp.send(getInfoBody());
            
        });
        }
        function getInfoBody() {
            var f = {};
            f.titulo_pub = document.getElementById("titulo").value;
            f.tipo_articulo = e.options[e.selectedIndex].value;
            f.precio_dia = document.getElementById("precio-x-dia").value;
            f.descripcion = document.getElementById("descripcion").value;
            f.disponible = 1;
            var json = JSON.stringify(f);
            console.log(json);
            return json;
        }
    </script>
</body>
</html>
